<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./hanja_maker_2.js"></script>
    <script src="https://chonggi-tokhu.github.io/files/kin_choice/new/ColourgreyShorterCSSJS-0.0.1.js"></script>
    <link rel="stylesheet" href="https://chonggi-tokhu.github.io/files/kin_choice/new/ColourgreyShorter.css">
    <style>
        .work-outer .tools {
            display: flex;
        }

        .work-outer .tools-item {
            margin-left: 0.5rem;
            margin-right: 0.5rem;
            padding: 0.1rem;
            border: 1px solid #000000;
        }

        .work-outer .tools-item.selected-tool {
            border: 2px solid #2e48ba;
        }
    </style>
</head>

<body>
    <div class="work-outer">
        <div class="tools-menu">
            <div class="tools">
                <div class="tools-item">
                    <button class="action-btn" data-cmd="start_stroke">획 시작</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn" data-cmd="add_moving">출발점 찍기</button>
                </div>
                <!-- <div class="tools-item">
                        <button class="action-btn" data-cmd="start_stroke add_line">선 추가(자동으로 획 시작)</button>
                    </div>
                    <div class="tools-item">
                        <button class="action-btn" data-cmd="add_moving add_line">선 추가(자동으로 출발점 찍힘)</button>
                    </div> -->
                <div class="tools-item">
                    <button class="action-btn" data-cmd="add_line">선 추가</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn" data-cmd="add_curve">곡선 추가</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn" data-cmd="end_stroke">획 끝내기</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn" data-cmd="clear">모두 지우기</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn" data-cmd="apply_to_svg" onclick="hanjaMaker0.apply_to_svg();">SVG에
                        적용</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn" data-cmd="make_mp4">MP4화</button>
                </div>
                <div class="tools-item">
                    <input type="checkbox" id="clicktodraw_check">
                    <label for="clicktodraw_check">클릭해서 그리기(옵션)</label>
                </div>
            </div>
            <div class="tools">
                <div class="tools-item">
                    <button class="action-btn-2" data-cmd-type="line">선 그리기(속성)</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn-2" data-cmd-type="curve">곡선 그리기(속성)</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn-2" data-cmd-type="stop">획 끊기</button>
                </div>
                <div class="tools-item">
                    <button class="action-btn-2" data-cmd-type="off">모든 도구 사용 중지</button>
                </div>
            </div>
            <div class="tools">
                <div class="tools-item" style="display: flex;">
                    <input type="text" onchange="strokeobj.stroke_colour=this.value" placeholder="획 색깔">
                    <input type="text" onchange="strokeobj.stroke_width=this.value" placeholder="획 두께">
                    <input type="text" onchange="strokeobj.bgstroke_width=this.value" placeholder="획 배경 두께">
                    <button onclick="hanjaMaker0.set_stroke(strokeobj);">획 설정</button>
                </div>
                <div class="tools-item">
                    <input type="number" id="removeidx" placeholder="삭제할 획 인덱스">
                    <button class="action-btn-2"
                        onclick="hanjaMaker0.remove_stroke(parseInt(document.getElementById('removeidx').value));">획
                        삭제</button>
                </div>
            </div>
        </div>
        <div id="work" class="work"></div>
        <div style="display:flex;">
            <div>
                <input type="checkbox" id="marking_check">
                <label for="marking_check">좌표찍을때 라벨 붙이기(옵션)</label>
            </div>
            <div>
                <input type="checkbox" id="auto_check" checked>
                <label for="auto_check">아래 도구 쓸 때 자동으로 SVG에 적용</label>
            </div>
            <div>
                <button onclick="hanjaMaker0.svgelparent.focus()">작업 바로가기</button>
            </div>
            <div>
                <button onclick="getSVGCode();">svg 코드 보기</button>
            </div>
            <div>
                <button onclick="showHelp();">도움말 보기</button>
            </div>
        </div>
    </div>
    <script>
        var ColourgreyShorterJS = typeof window['ColourgreyShorterJS'] === 'object' && window['ColourgreyShorterJS'] !== null ? window['ColourgreyShorterJS'] : { ColourgreyShorterCSS: function () { return false; } };
        var cgrshorter = new ColourgreyShorterJS.ColourgreyShorterCSS(false);
        var hanja_maker = typeof window['hanja_maker'] === 'function' ? window['hanja_maker'] : class { };
        var hanjaMaker0 = new hanja_maker('work');
        hanjaMaker0.add_key_listeners();
        var selected_tool = false;
        var selected_tool2 = false;
        var lastxy = false;
        var currxy = [];
        var auto = auto_check?.checked || false;
        var spacekeypressed = false;
        var strokeobj = {
            stroke_colour: '#202020',
            bgstroke_width: /* 21.6 */14,
            stroke_width: /* 14.4 */ 12,
        };
        document.querySelectorAll('.action-btn').forEach((el, idx, par) => {
            el.addEventListener("click", (ev) => {
                var cmd = el.getAttribute("data-cmd");
                selected_tool = cmd;
                document.querySelector('.tools-item.selected-tool')?.classList?.remove('selected-tool');
                el.parentElement.classList.add("selected-tool");
                hanjaMaker0.select_tool(cmd);
            });
        });
        function listener0(ev) {
            if (spacekeypressed) {
                listener1(ev);
            }
            currxy.push(ev.offsetX + ' ' + ev.offsetY);
            if (currxy.length >= 2) {
                hanjaMaker0.add_line_easy(currxy[0], currxy[1], lastxy);
                if (!spacekeypressed) {
                    lastxy = ev.offsetX + ' ' + ev.offsetY;
                }
                currxy = [];
            }
        }
        function listener2(ev) {
            if (spacekeypressed) {
                listener1(ev);
            }
            currxy.push(ev.offsetX + ' ' + ev.offsetY);
            console.log(currxy);
            if (currxy.length >= 3) {
                console.log('3!');
                hanjaMaker0.strokes.pop();
                hanjaMaker0.strokes.push('');
                hanjaMaker0.add_curve_easy(currxy[0], currxy[1], currxy[2], currxy[0]);
                if (!spacekeypressed) {
                    lastxy = ev.offsetX + ' ' + ev.offsetY;
                }
                currxy = [];
            }
        }
        //start_stroke(80 80);add_line(80 80,200 200);add_line(200 200,100 60);apply_to_svg();
        function listener1(ev) {
            hanjaMaker0?.start_stroke(ev.offsetX + ' ' + ev.offsetY ? ev.offsetX + ' ' + ev.offsetY : '0 0');
            lastxy = ev.offsetX + ' ' + ev.offsetY;
        }
        document.querySelectorAll('.action-btn-2').forEach((el, idx, par) => {
            el.addEventListener("click", (ev) => {
                var cmd = el.getAttribute("data-cmd-type");
                selected_tool2 = cmd;
                document.querySelector('.tools-item.selected-tool')?.classList?.remove('selected-tool');
                el.parentElement.classList.add("selected-tool");
                /* if (cmd === 'line') {
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener2);
                    hanjaMaker0?.svgelparent?.addEventListener("click", listener0);
                } else if (cmd === 'stop') {
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener0);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener2);
                    hanjaMaker0?.svgelparent?.addEventListener("click", listener1);
                } else if (cmd === 'off') {
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener0);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener2);
                } else if (cmd === 'curve') {
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener0);
                    hanjaMaker0?.svgelparent?.addEventListener("click", listener2);
                }
                if (auto) {
                    console.log('...');
                    hanjaMaker0.apply_to_svg();
                } */

                if (cmd === 'line') {
                    //hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener2);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener0);
                    hanjaMaker0?.svgelparent?.addEventListener("click", listener0);
                } else if (cmd === 'stop') {
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.addEventListener("click", listener1);
                } else if (cmd === 'off') {
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener0);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener2);
                } else if (cmd === 'curve') {
                    //hanjaMaker0?.svgelparent?.removeEventListener("click", listener1);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener0);
                    hanjaMaker0?.svgelparent?.removeEventListener("click", listener2);
                    hanjaMaker0?.svgelparent?.addEventListener("click", listener2);
                }
                if (auto) {
                    hanjaMaker0.apply_to_svg();
                }
            });
        });
        var clicktodraw_check = document.querySelector('#clicktodraw_check');
        clicktodraw_check?.addEventListener("change", (ev) => {
            hanjaMaker0.set_clicktodraw(clicktodraw_check.checked);
            if (!hanjaMaker0.clicktodraw) {
                selected_tool = false;
                selected_tool2 = false;
                document.querySelector('.tools-item.selected-tool')?.classList?.remove('selected-tool');
            }
        });
        var marking_check = document.querySelector('#marking_check');
        marking_check.addEventListener("change", (ev) => {
            hanjaMaker0.set_marking(marking_check.checked);
        });
        var auto_check = document.querySelector('#auto_check');
        auto_check.addEventListener("change", (ev) => {
            auto = auto_check.checked;
        });
        auto = auto_check.checked;
        function getSVGCode(){
            var newSVG=document.createElement("svg");
            newSVG.width=hanjaMaker0.svgel.width;
            newSVG.height=hanjaMaker0.svgel.height;
            newSVG.innerHTML=hanjaMaker0.svgel.innerHTML;
            newSVG.querySelector(".points").remove();
            newSVG.querySelector(".bg").remove();
            window.prompt('복사 ㄱ',newSVG.outerHTML);
        }
        function showHelp(){
            var helpHTML=`<div>
                <h4><span>도움말</span></h4>
                <p><span>pc버전에서 키보드 키와 마우스를 통해 그릴 수 있습니다.</span></p>
                <p><span>먼저, 위의 메뉴의 버튼들은 &apos;SVG에 적용&apos; 버튼을 제외하고는 모두 무시하고, 아래쪽에서 &apos;좌표 찍을때 라벨 붙이기(옵션)&apos; 체크박스를 체크한 상태로, 만들 글자의 획이 시작하거나 끝나는 부분, 그리고 꼭지점, 베지어곡선의 세 제어점에 해당하는 위치에 마우스를 클릭해가며 점을 찍어주세요.</span></p>
                <p><span>그리고, 다음 표에 따라 행동해주세요.</span></p>
                <div>
                    <table>
                        <tr>
                            <th>누를 키</th>
                            <th>작동</th>
                        </tr>
                        <tr>
                            <td>S</td>
                            <td>해당 점을 선택상태에 둠</td>
                        </tr>
                        <tr>
                            <td>U+S</td>
                            <td>해당 점을 선택상태에서 해제</td>
                        </tr>
                        <tr>
                            <td>B</td>
                            <td>해당 점에서 획을 시작</td>
                        </tr>
                        <tr>
                            <td>M</td>
                            <td>해당 점으로 그리는 도구를 이동(L과 똑같이 작동하는데 지나간 자리에 선을 남기지 않는다고 보면 됨)</td>
                        </tr>
                        <tr>
                            <td>L</td>
                            <td>해당 점으로 선분을 이음</td>
                        </tr>
                        <tr>
                            <td>C</td>
                            <td>베지어곡선의 제어점</td>
                        </tr>
                        <tr>
                            <td>Z</td>
                            <td>획을 끝냄</td>
                        </tr>
                    </table>
                </div>
                <p><span>이상의 표를 갖고 그려주시면 됩니다.</span></p>
                <p><span>예를 들어, (0,0)에서 (20,20)으로 간 뒤 (40, 0)으로 가는데 한획으로 이어지고, 다음 획으로 (20,20)에서 시작해 (20,80)으로 가는 획이 있는 글자(대문자 Y모양이 나올것입니다)를 그리고 싶다면,</span></p>
                <p><span>&apos;좌표 찍을때 라벨 붙이기&apos; 옵션에 체크를 한 뒤, (0,0)에 마우스를 클릭해 라벨을 남깁니다. 그 다음으로 (20,20)에, (40,0)에, (20,80)에 똑같이 합니다.</span></p>
                <p><span>다음으로, S키를 누른 상태에서, B키를 누른 상태에서, M키를 누른 상태에서 (0,0)에 표시했던 라벨을 클릭합니다. 그리고 L 키를 누른 상태에서 클릭합니다. (이때, 저 키들을 모두 동시에 누른 상태에서 할 필요는 없습니다. 애초부터 키 조합 자체가 2개 이상 있는 키, 이를테면 선택취소기능이 있는 U+S 키같은것을 제외하면 다 하나하나씩 눌러도 됩니다)</span></p>
                <p><span>그리고 (20,20)에 표시했던 라벨을 S키를 누른 상태에서, L키를 누른 상태에서 클릭합니다.</span></p>
                <p><span>다음으로 (40,0)에 표시했던 라벨을 S키를 누른 상태에서, L키를 누른 상태에서 클릭합니다. Z키를 누른 상태에서 클릭합니다. </span></p>
                <p><span>(지금까지 따로 클릭했던 점들을 S키를 누른 상태에서 3점의 라벨을 다 클릭한 뒤,그 후 세 점들에 각각 B,M,L을, L을, L,Z를 눌러도 상관 없을것입니다.)</span></p>
                <p><span>상단 메뉴 &apos;SVG에 적용&apos; 버튼을 누릅니다.</span></p>
                <p><span>이제 (0,0),(20,20),(40,0)의 세 라벨 모두 각각 U와 S를 <span style="font-weight:bold;">동시에</span> 누른 상태에서 클릭합니다.</span></p>
                <p><span>그리고 S키를 누른 상태에서, B키를 누른 상태에서,M키를 누른 상태에서, L키를 누른 상태에서 (20,20)의 라벨을 클릭합니다.</span></p>
                <p><span>(20,80)에 표시한 라벨을 S키를 누른 상태에서, L키를 누른 상태에서, Z키를 누른 상태에서 클릭합니다.</span></p>
                <p><span>SVG에 적용을 누릅니다.</span></p>
                <p><span>완성입니다.</span></p>
            </div>`;
            var alertWinElPr = document.createElement("div");
            var alertWinEl = document.body.appendChild(alertWinElPr);
            alertWinEl.style.display="block"; 
            alertWinEl.style.width="fit-content"; 
            alertWinEl.style.background="#90ee9080"; 
            alertWinEl.style.top=`calc((100vh - 400px) / 2)`; 
            alertWinEl.style.left=`calc((100vw - 400px) / 2)`; 
            alertWinEl.style.boxShadow="0.8rem 0.8rem 0.8rem 0.8rem #222222, -0.8rem 0.8rem 0.8rem 0.8rem #222222, 0.8rem -0.8rem 0.8rem 0.8rem #222222, -0.8rem -0.8rem 0.8rem 0.8rem #222222";
            alertWinEl.style.position="fixed"; 
            alertWinEl.style.zIndex="5000";
            var alertWinCloseBtn=alertWinEl.appendChild(document.createElement("button"));
            alertWinCloseBtn.innerHTML=`&times;`;
            alertWinCloseBtn.addEventListener("click",(ev)=>{
                alertWinEl.remove();
            });
        }
        window.addEventListener("DOMContentLoaded", (ev) => {
            document.querySelectorAll('.tools').forEach((el, idx, par) => {
                el.addEventListener("keydown", (ev) => {
                    if (ev.key === ' ') {
                        console.log('aaa');
                        spacekeypressed = true;
                        ev.preventDefault();
                    }
                });
            });
            document.querySelectorAll('.tools').forEach((el, idx, par) => {
                el.addEventListener("keyup", (ev) => {
                    if (ev.key === ' ') {
                        spacekeypressed = false;
                        ev.preventDefault();
                    }
                });
            });
            hanjaMaker0.add_key_listeners();
            /* document.querySelector('#work>div').addEventListener('keypress', (ev) => {
                if (ev.key === 'a') {
                    document.querySelector(`[data-cmd="start_stroke"]`).click();
                } else if (ev.key === 's') {
                    document.querySelector(`[data-cmd="add_moving"]`).click();
                } else if (ev.key === 'd') {
                    document.querySelector(`[data-cmd="add_line"]`).click();
                } else if (ev.key === 'f') {
                    document.querySelector(`[data-cmd="add_curve"]`).click();
                } else if (ev.key === 'g') {
                    document.querySelector(`[data-cmd="end_stroke"]`).click();
                } else if (ev.key === 'h') {
                    document.querySelector(`[data-cmd="clear"]`).click();
                } else if (ev.key === 'j') {
                    document.querySelector(`[data-cmd="apply_to_svg"]`).click();
                }
            }) */
            cgrshorter?.styleAll();
        });
    </script>
</body>

</html>